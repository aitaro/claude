# Pull Request 作成コマンド

このコマンドは現在の作業内容から自動的に Pull Request を作成します。

## 使用方法

```
/pr [追加の指示]
```

例:

- `/pr` - 自動的に PR を作成
- `/pr レビュー優先度高め`
- `/pr WIPとして作成`
- `/pr Linear の XXX-YYY に紐付け`

## 実行内容

追加の指示がある場合は、それに応じて以下の処理を調整します。

1. **現在のブランチと状態を確認**

   - 現在のブランチ名を確認（`git branch --show-current`）
   - 変更の有無を確認（`git status`）
   - リモートとの差分を確認（`git diff`, `git log`）

2. **ブランチに応じた処理**

   **main ブランチにいる場合:**

   - 変更がある場合、新しいブランチを作成
   - ブランチ名を自動生成または対話的に決定
   - `git checkout -b feature/[branch-name]`

   **既存のブランチにいる場合:**

   - そのままコミット＆プッシュの準備

3. **変更をコミット**

   - 変更内容を確認（`git diff`）
   - 意味のあるコミットメッセージを生成
   - `git add .` と `git commit -m "[message]"`
   - 必要に応じて複数コミットに分割

4. **リモートにプッシュ**

   ```bash
   git push -u origin [branch-name]
   ```

5. **Pull Request 作成**

   - `gh pr create` を使用
   - 日本語でタイトルとボディを自動生成
   - 変更内容に基づいた説明を含める
   - PR が不完全でまだ作業を続行する意図がありそうであれば draft で出してください。そうでなければ基本は claude ラベルをつけて、auto-merge を on にしておいてください。

6. **後処理**

   - PR URL を表示
   - 必要に応じてレビュアーを提案
   - Linear のタスクステータスを更新（該当する場合）

## 自動判定ロジック

2. **コミットメッセージの生成**

   - 変更ファイルと内容から適切なメッセージを生成
   - 既存のコミットスタイルに合わせる

3. **PR タイトルとボディの生成**
   - 変更内容を要約
   - 実装の詳細を箇条書きで記載
   - テストプランを含める

## 必要な設定

1. **GitHub CLI (gh)**

   - `gh` コマンドが使用可能であること
   - GitHub への認証が完了していること

2. **Git 設定**

   - リモートリポジトリが設定されていること
   - ユーザー名とメールアドレスが設定されていること

3. **Linear MCP 接続**（オプション）
   - Linear との連携が必要な場合
   - MCP 経由で接続が確立されていること

## オプション

- `--draft`: Draft PR として作成
- `--no-push`: プッシュをスキップ（ローカルコミットのみ）
- `--base <branch>`: ベースブランチを指定（デフォルト: main）
- `--title <title>`: PR タイトルを明示的に指定
- `--body <body>`: PR ボディを明示的に指定

## エラーハンドリング

- コンフリクトがある場合は解消方法を提案
- 未コミットの変更がある場合は確認を求める
- リモートブランチが既に存在する場合は差分を確認
- PR が既に存在する場合は更新を提案
